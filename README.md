## Bradley-Terry Ranking

This repository provides a simple **pairwise ranking** system using FastAPI. 
It enables multiple raters compare pairs of images (generated by different model weights) and collects their preferences to find out which weight performs best.

### Contents

- [Features](#features)  
- [Project Structure](#project-structure)  
- [Requirements](#requirements)  
- [Setup](#setup)  
- [Usage](#usage)  
- [Endpoints](#endpoints)  
- [License](#license)  

---

### Features
- **Flexible Data Format**: Organize data by weights with any number of inputs and outputs.  
- **Pairwise Comparison UI**: A simple web interface where users click the images they prefer.  
- **Scoring System**: Dynamically updates scores (`+1` / `-1` / `0`) based on user choices.  
- **Randomized Order**: Each rater sees comparisons in a different random sequence.  
- **Persistent Storage**: A JSON file stores each rater’s progress and overall scores, so you can resume after server restarts.

---

### Project Structure

```
bradley-terry-ranking/
├─ pairwise_ranking.py      # Main FastAPI app and logic
├─ input_data.json          # Example input (organized by weights)
├─ progress_store.json      # Auto-created file storing scores & user progress
├─ images/                  # Static image files (organized by weight/other)
├─ .venv/                   # (Optional) Your Python virtual environment
└─ README.md                # This README documentation
```

---

### Requirements
- Python 3.7+  
- [FastAPI](https://fastapi.tiangolo.com/)  
- [Uvicorn](https://www.uvicorn.org/) (ASGI server)

Install dependencies (for example, via `pip`):

```bash
pip install -r requirements.txt
```

---

### Setup

1. **Clone the Repo**  
   ```bash
   git clone https://github.com/RareSense/bradley-terry-ranking.git
   cd bradley-terry-ranking
   ```
2. **Create & Activate a Virtual Environment (Optional but recommended)**  
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux/Mac
   # or .venv\Scripts\activate on Windows
   ```
3. **Install Dependencies**  
   ```bash
   pip install -r requirements.txt
   ```
4. **Place Your Images**  
   Make sure you have an `images/` directory (or another static directory) with subfolders for each weight if needed. Your `input_data.json` should point to these image paths (e.g., `/static/w1/dp1_w1.jpg`).
5. **Update `input_data.json`**  
   - **`weights`**: The list of model weights (e.g., `["w1", "w2"]`).  
   - **`inputs`**: Each test datapoint has an ID and possibly a text prompt/image.  
   - **`outputs`**: For each weight, a list of output image paths corresponding to each datapoint in `inputs`.

---

### Usage

1. **Start the Server**  
   ```bash
   uvicorn pairwise_ranking:app --reload --host 0.0.0.0 --port 8000
   ```
   - Access the app at: [http://localhost:8000/task?rater_id=alice](http://localhost:8000/task?rater_id=alice)

2. **Rate Images**  
   - A web page will display pairwise comparisons.  
   - Click one or both images to select them (or select none).  
   - Press **Submit** to record your choice.  
   - Repeat until you’ve seen all comparisons.

3. **Check Results**  
   - Visit [http://localhost:8000/results](http://localhost:8000/results) for a JSON summary of the aggregated scores.  
   - Each weight accumulates points based on all raters’ choices.

4. **Monitor Progress**  
   - For any rater, check how many tasks they’ve completed. E.g. for rater called `alice`:
     ```
     http://localhost:8000/status?rater_id=alice
     ```

---

### Endpoints

- **`GET /task?rater_id=<unique_id>`**  
  - Returns the next pairwise comparison for the rater, or a thank-you message if finished.

- **`POST /submit`**  
  - Processes the user’s selection and updates scores and the user’s progress.

- **`GET /results`**  
  - Returns a JSON dictionary of the final scores (one entry per weight).

- **`GET /status?rater_id=<unique_id>`**  
  - Shows how many comparisons this rater has completed vs. the total.

---

### License

This repository is licensed under the [MIT License](LICENSE).

---

## Contributing
Feel free to open an issue or submit a pull request if you have suggestions or find any bugs.  

**Happy ranking!**
